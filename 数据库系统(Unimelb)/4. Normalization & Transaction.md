# $\text{Normalization \& Transaction}$ 

# $\text{1. Normalization}$

> ## $\text{1.1. Normalization}$​定义
>
> > **1️⃣**定义
> >
> > |                          |                  操作                  |                       目的                        |
> > | :----------------------: | :------------------------------------: | :-----------------------------------------------: |
> > |  $\text{Normalization}$  | 一大表格$\xrightarrow{拆分}$若干小表格 | 去除$\text{Redundancies}$从而避免$\text{Anomoly}$ |
> > | $\text{Denormalization}$ | 一大表格$\xleftarrow{拼接}$若干小表格  |              避免频繁的$\text{Join}$              |
> >
> > ⚠️$\text{Fully Normalized = Eliminate All Anomalies}$，一般到$\text{4NF}$才算完全归一化
> >
> > **2️⃣**示例
> >
> > 1. 标准化前
> >
> >    | $\text{StuID}$ | $\text{SName}$ | $\text{CID}$ |  $\text{CName}$  |
> >    | :------------: | :------------: | :----------: | :--------------: |
> >    |   $\text{1}$   | $\text{John}$  | $\text{101}$ |  $\text{Math}$   |
> >    |   $\text{2}$   | $\text{Mary}$  | $\text{102}$ | $\text{English}$ |
> >    |   $\text{1}$   | $\text{John}$  | $\text{103}$ | $\text{Physics}$ |
> >    |   $\text{3}$   | $\text{Peter}$ | $\text{101}$ |  $\text{Math}$   |
> >    |   $\text{2}$   | $\text{Mary}$  | $\text{103}$ | $\text{Physics}$ |
> >
> > 2. 标准化后
> >
> >    | $\small\text{学生表}$ | $\small\text{StuID}$ | $\small\text{SName}$ | $\small\text{课程表}$ | $\small\text{CID}$ |  $\small\text{CName}$  | $\small\text{学生-课程表}$ | $\small\text{StuID}$ | $\small\text{CID}$ |
> >    | :-------------------: | :------------------: | :------------------: | :-------------------: | :----------------: | :--------------------: | :------------------------: | :------------------: | :----------------: |
> >    |      $\text{\\}$      |      $\text{1}$      | $\small\text{John}$  |      $\text{\\}$      |    $\text{101}$    |  $\small\text{Math}$   |        $\text{\\}$         |      $\text{1}$      |    $\text{101}$    |
> >    |      $\text{\\}$      |      $\text{2}$      | $\small\text{Mary}$  |      $\text{\\}$      |    $\text{102}$    | $\small\text{English}$ |        $\text{\\}$         |      $\text{2}$      |    $\text{102}$    |
> >    |      $\text{\\}$      |      $\text{1}$      | $\small\text{John}$  |      $\text{\\}$      |    $\text{103}$    | $\small\text{Physics}$ |        $\text{\\}$         |      $\text{1}$      |    $\text{103}$    |
> >    |      $\text{\\}$      |      $\text{3}$      | $\small\text{Peter}$ |      $\text{\\}$      |    $\text{101}$    |  $\small\text{Math}$   |        $\text{\\}$         |      $\text{3}$      |    $\text{101}$    |
> >    |      $\text{\\}$      |      $\text{2}$      | $\small\text{Mary}$  |      $\text{\\}$      |    $\text{103}$    | $\small\text{Physics}$ |        $\text{\\}$         |      $\text{2}$      |    $\text{103}$    |
> >
> > **3️⃣**$\text{Normalization/Denormalization}$对比
> >
> > |         操作         | $\text{Normalization}$，比如$\text{A, B}$ | $\text{Denormalization}$，比如$\text{A}\bowtie{}\text{B}$ |
> > | :------------------: | :---------------------------------------: | :-------------------------------------------------------: |
> > | 查询速度(查询一个表) |                    快                     |                            慢                             |
> > | 查询速度(查询两个表) |                    慢                     |                            快                             |
> > |    插入/修改/删除    |                   容易                    |                           困难                            |
>
> ## $\text{1.2. Database Anomalies}$​异常
>
> > **1️⃣**概述：期末会给你表格，让你用文字描述举例三种$\text{Anomaly}$​ 
> >
> > 1. 示例表格
> >
> >    | $\text{Order(PFK)}$ | $\text{Item(PFK)}$ |  $\text{Desc}$  | $\text{Qty}$ |
> >    | :-----------------: | :----------------: | :-------------: | :----------: |
> >    |     $\text{27}$     |    $\text{873}$    |  $\text{nut}$   |  $\text{2}$  |
> >    |     $\text{28}$     |    $\text{873}$    |  $\text{nut}$   | $\text{10}$  |
> >    |     $\text{30}$     |    $\text{495}$    | $\text{washer}$ | $\text{50}$  |
> >
> > 2. 基本概念
> >
> >    |  $\text{Anomaly}$  |              含义              | 示例(下表)                                                   |
> >    | :----------------: | :----------------------------: | :----------------------------------------------------------- |
> >    | $\text{Insertion}$ | 插入数据$\text{→}$插入其他数据 | 插入$\text{Item/Desc}\xrightarrow{还需}$插入$\text{Order/Qty}$ |
> >    | $\text{Deletion}$  | 删除数据$\text{→}$删除其他数据 | 删除$\text{Order30}\xrightarrow{引起}$整行删除               |
> >    |  $\text{Update}$   | 更新数据$\text{→}$更新其他数据 | 更新$\text{Item873}$的$\text{Desc}\xrightarrow[有两处\text{Item873}]{引起}$两处$\text{Desc}$更新 |
> >
> > **2️⃣**用$\text{NULL}$来解决$\text{Anomaly:}$ 不能根本解决
> >
> > 1. $\text{Insertion Anomaly}$可能可以，原因在于$\text{PK}$是不能$\text{NULL}$的
> >    - 可以的示例：插入$\text{Order/Item/Desc}\to{}\text{Qty}$为$\text{NULL}$ 
> >    - 不可以的示例：插入$\text{Item/Desc}\to{}\text{Qty}$为$\text{NULL/}\text{Order}$不能为$\text{NULL}$​ 
> > 2. $\text{Deletion Anomaly:}$  同理可能可以，当删除的数据不是$\text{PK}$时，可考虑设为$\text{NULL}$ 
> > 3. $\text{Update Anomaly:}$ 绝对没戏，不可能更新成$\text{NULL}$ 
>
> ## $\text{1.3. Functional Dependencies}$​ 
>
> > **1️⃣**概述
> >
> > 1. 定义：$\text{A set of attributes X determines another set of attributes Y uniquely}$ 
> > 2. 符号：$\text{X}\to{}\text{Y}$表示如果知道$\text{X}$就知道$\text{Y}$，比如$\text{Stu}\to{}\text{Stu-Name}$​ 
> > 3. 性质：
> >    - 依赖恒等式：$\text{X}\to{}\text{X}$ ，$\text{PK}\to{}\text{All Column}$​ 
> >    - 拆分原则$\text{: AB}\to{}\text{CD}\begin{cases}可以拆分为\text{: AB}\to{}\text{C + }\text{AB}\to{}\text{D}\\\\不可拆分为\text{: A}\to{}\text{CD + }\text{B}\to{}\text{CD}\end{cases}\to{}只有右侧可拆分$​ 
> >
> > **2️⃣**有关概念：以$\text{A}(\underline{\text{X}}, \underline{\text{Y}}, \text{Z}, \text{D})$为例
> >
> > 1. $\text{Determinants:}$ 
> >
> >    - 箭头左侧的属性，比如$\underline{\text{X}} ,\underline{\text{Y}}\to{}\text{Z}$中的$\text{XY}$
> >    - 至于这其中$\text{Z}$是什么就无具体说法
> >
> > 2. $\text{Key/Non-Key}$属性：包含/不包含$\text{PK}$的属性，比如
> >
> >    |       属性类型       |                        含义                        |                     示例                     |
> >    | :------------------: | :------------------------------------------------: | :------------------------------------------: |
> >    |   $\text{Key}$属性   | 包含$\text{PK}$的属性，或者说是$\text{PK}$的一部分 | $\underline{\text{X}} ,\underline{\text{Y}}$ |
> >    | $\text{Non-Key}$属性 |                      其余属性                      |             $\text{Z} ,\text{D}$             |
> >
> > 3. 两种$\text{Dependency}$​​  
> >
> >    |                依赖类型                |                             含义                             |                 示例                 |
> >    | :------------------------------------: | :----------------------------------------------------------: | :----------------------------------: |
> >    | $\text{Partial Functional Dependency}$ | $\text{Key}$属性($\text{PK}$的一部分)$\xrightarrow{决定}\text{Non-Key}$属性 | $\underline{\text{Y}} \to{}\text{Z}$ |
> >    | $\text{Transitive Dependency}$(传递性) |  $\text{Non-Key}$属性$\xrightarrow{决定}\text{Non-Key}$属性  |       $\text{Z} \to{}\text{D}$       |
> >
> > **3️⃣**$\text{Armstrong’s Axioms}$(公理)
> >
> > |       $\text{Axioms}$       |                             条件                             | $\Rightarrow$ |               结果                |                 备注                  |
> > | :-------------------------: | :----------------------------------------------------------: | :-----------: | :-------------------------------: | :-----------------------------------: |
> > |    $\text{Reflexivity}$     |                $\text{B}\subseteq\text{A}$                | $\Rightarrow$ |  $\text{A} \rightarrow \text{B}$  | 或者说$\text{A}\text{B}\to{}\text{A}$ |
> > | $\text{Augmentation}$(扩展) |               $\text{A}\rightarrow\text{B}$               | $\Rightarrow$ | $\text{AC} \rightarrow \text{BC}$ |             $\text{N/A}$              |
> > |     $\text{Transitive}$     | $\text{A} \rightarrow \text{B }\land{}\text{ B}\rightarrow \text{C}$ | $\Rightarrow$ |  $\text{A} \rightarrow \text{C}$  |             $\text{N/A}$              |
>
> ## $\text{1.4. Normal Form}$​ 
>
> > **0️⃣**$\text{Overview}$ 
> >
> > |  $\text{Normal Form}$   | $\text{Description}$                                         |
> > | :---------------------: | ------------------------------------------------------------ |
> > | $\text{Non-Relational}$ | 混沌之物                                                     |
> > |      $\text{1NF}$       | 无$\text{Repeating Groups}$                                  |
> > |      $\text{2NF}$       | 无$\text{Repeating Groups+}\text{Partial Dependency}$        |
> > |      $\text{3NF}$       | 无$\text{Repeating Groups+}\text{Partial Dependency+}\text{Transitive Dependency}$ |
> >
> > **1️⃣**$\text{1NF}$​ $$
> >
> > 1. $\text{1NF}$ 的基本特征：不满足以下特征的就是$\text{Non-Relational Model}$ 
> >    - 不能有重复的列
> >    - 表中一个单元($\text{Fill}$)只能有一个数据，不同数据用`,`隔开(但有些数据本就有`,`如$\text{Address}$​)
> >
> > 2. $\text{Non-Relational Model→1NF:}$
> >
> >    - 将$\text{Repeating Groups}$从原表中拆分成新表
> >    - 将原表的$\text{PK}\begin{cases}一份保留在原关系\to{}作\text{PK}\\\\一份复制到新关系\to{}作\text{PFK}\end{cases}$ 
> >
> > 3. 示例：注意区分$\underline{\text{PK}}$，$\overline{{\text{FK}}}$，$\overline{\underline{\text{PFK}}}$的表示方法
> >
> >    $\text{Order-Item(}\underline{\text{Order}}\text{, Cust, (}\underline{\text{Item}}\text{, Desc, Qty))}\text{→}\begin{cases}\text{Order(}{\underline{\text{Order}}}\text{, Cust)}\\\\\text{Order-Item(}\overline{\underline{\text{Order}}}\text{, }\underline{\text{Item}}\text{, Desc, Qty)}\end{cases}$ 
> >
> > **2️⃣**$\text{2NF}$ 
> >
> > 1. $\text{2NF}$基本特征：$\text{Part of Composite Key}\xrightarrow[❌]{\text{Identify}}\text{Non-key Attribut}$ 
> >
> > 2. $\text{1NF→2NF:}$ 移除$\text{Partial Dependencies}$​​ 
> >
> >    - 把$\text{Partial Dependencies}$从原关系中剥离出来
> >    - $\text{Partial Dependencies}$的$\text{Determinant}\begin{cases}一份保留在原关系\to{}作\text{PFK}\\\\一份剥离到新关系\to{}作\text{PK}\end{cases}$ 
> >
> > 3. 示例：注意区分$\underline{\text{PK}}$，$\overline{{\text{FK}}}$，$\overline{\underline{\text{PFK}}}$的表示方法
> >
> >    - 假设$\begin{cases}\overline{\underline{\text{Order}}},\underline{\text{Item}}\to{}\text{Qty}\\\\\underline{\text{Item}}\to{}\text{Desc (Partial Dependency)}\end{cases}$
> >
> >    - $\text{Order-Item}\text{→}\begin{cases}\text{Order(}\underline{\text{Order}}\text{, Cust)}\\\\\text{Order-Item(}\overline{\underline{\text{Order}}}\text{, }\underline{\text{Item}}\text{, Desc, Qty))→}\begin{cases}\text{Item}(\underline{\text{Item}},\text{Desc})\\\\\text{Order-Item(}\overline{\underline{\text{Order}}}\text{, }\overline{\underline{\text{Item}}}\text{ Qty)}\end{cases}\end{cases}$    
> >
> > **3️⃣**$\text{3NF}$​​ 
> >
> > 1. $\text{3NF}$基本特征：$\text{Non-key Attribut}\xrightarrow[❌]{\text{Identify}}\text{Non-key Attribut}$​  
> > 2. $\text{2NF→3NF:}$ 移除$\text{Transitive Dependencies}$​​ 
> >    - 把$\text{Transitive Dependency}$从原关系剥离出来
> >    - $\text{Transitive Dependency}$的$\text{Determinant}\begin{cases}一份保留在原关系\to{}作\text{FK}\\\\一份剥离到新关系\to{}作\text{PK}\end{cases}$ 
> > 3. 示例：注意区分$\underline{\text{PK}}$，$\overline{{\text{FK}}}$，$\overline{\underline{\text{PFK}}}$的表示方法
> >    - 假设$\begin{cases}\underline{\text{Empt}}\to{}\text{Ename, Dept}\\\\{\text{Dept}}\to{}\text{Dname (Transitive Dependency)}\end{cases}$
> >    - $\text{Emp(}\underline{\text{Emp}}\text{, Ename, Dept, Dname)}\to{}\begin{cases}\text{Emp(}\underline{\text{Emp}}\text{, Ename, }\overline{\text{Dept})}\\\\\text{Dept(}\underline{\text{Dept}}\text{, Dname)}\end{cases}$ 
> >
> > **4️⃣**其他级别的$\text{NF}$==(课外，可不看)== 
> >
> > 1. $\text{BCNF:}$ $\text{Non-key Attribut}\xrightarrow[❌]{\text{Identify}}\text{Part of Composite Key}$​  
> >
> > 2. $\text{4NF:}$解决$\text{Multivalue Dependency}$
> >
> >    - 多值依赖：比如若下列$\begin{cases}\text{M}\xrightarrow{✔️}\text{S}\\\text{M}\xrightarrow{✔️}\text{C}\\\text{C}\xleftrightarrow{❌}\text{S}\end{cases}\to$则存在多值依赖，且记为$\begin{cases}\text{M→→S}\\\\\text{M→→C}\end{cases}$ 
> >
> >      | $\text{M}$  | $\text{S}$  | $\text{C}$  |
> >      | :---------: | :---------: | :---------: |
> >      | $\text{M1}$ | $\text{S1}$ | $\text{C1}$ |
> >      | $\text{M1}$ | $\text{S1}$ | $\text{C2}$ |
> >      | $\text{M1}$ | $\text{S2}$ | $\text{C1}$ |
> >
> >    - 当关系达到$\text{4NF}$时就认为完成$\text{Normalization}$了，已经没有$\text{Duplicates}$​​了
> >
> > 3. $\text{5NF:}$解决$\text{Loss Dependency}$
> >
> >    - 若表格拆开又拼回去不改变原表格($\text{Lossless-Join}$分解)，则表格就有$\text{Loss Dependency}$
> >    - 但实际上不会如此吹毛求疵了
> >

# $\text{2. Transaction}$​ 

> 